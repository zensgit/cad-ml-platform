# è‡ªé€‚åº”é™æµç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [é…ç½®æŒ‡å—](#é…ç½®æŒ‡å—)
5. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
6. [ç›‘æ§ä¸å‘Šè­¦](#ç›‘æ§ä¸å‘Šè­¦)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿæ¦‚è¿°

è‡ªé€‚åº”é™æµç³»ç»Ÿæ˜¯ä¸€ä¸ªæ™ºèƒ½çš„æµé‡æ§åˆ¶è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å®æ—¶åˆ†ææµé‡æ¨¡å¼å’Œç³»ç»Ÿè´Ÿè½½ï¼ŒåŠ¨æ€è°ƒæ•´é™æµå‚æ•°ï¼Œå®ç°ç³»ç»Ÿä¿æŠ¤ä¸ç”¨æˆ·ä½“éªŒçš„æœ€ä½³å¹³è¡¡ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **åŠ¨æ€é˜ˆå€¼è°ƒæ•´**: æ ¹æ®ç³»ç»Ÿè´Ÿè½½è‡ªåŠ¨è°ƒæ•´é™æµé˜ˆå€¼
- **å¤šç®—æ³•æ”¯æŒ**: ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ã€æ»‘åŠ¨çª—å£ã€è‡ªé€‚åº”çª—å£
- **æµé‡æ¨¡å¼è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«æ­£å¸¸ã€çªå‘ã€çˆ¬è™«ã€DDoSç­‰æ¨¡å¼
- **å‚æ•°è‡ªåŠ¨ä¼˜åŒ–**: åŸºäºæœºå™¨å­¦ä¹ çš„å‚æ•°æ ¡å‡†
- **æ€§èƒ½å½±å“ç›‘æ§**: å®æ—¶ç›‘æ§é™æµå¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“
- **SLAåˆè§„æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥å¹¶ç»´æŠ¤SLAç›®æ ‡

### ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¯·æ±‚æµé‡      â”‚â”€â”€â”€â”€â–¶â”‚  æµé‡åˆ†æå™¨      â”‚â”€â”€â”€â”€â–¶â”‚  æ¨¡å¼è¯†åˆ«       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                           â”‚
                                â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ€§èƒ½ç›‘æ§å™¨     â”‚â—€â”€â”€â”€â”€â”‚  è‡ªé€‚åº”é™æµå™¨    â”‚â—€â”€â”€â”€â”€â”‚  å‚æ•°æ ¡å‡†å™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   å†³ç­–æ‰§è¡Œ       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒç»„ä»¶

### 1. è‡ªé€‚åº”é™æµå™¨ (adaptive_rate_limiter.py)

è´Ÿè´£æ‰§è¡Œé™æµå†³ç­–ï¼Œæ”¯æŒå¤šç§ç®—æ³•ï¼š

```python
from scripts.adaptive_rate_limiter import AdaptiveRateLimiter, RateLimitConfig

# åˆ›å»ºé™æµå™¨
config = RateLimitConfig(
    algorithm="token_bucket",
    rate_limit=1000,  # è¯·æ±‚/ç§’
    burst_size=100,
    enable_adaptation=True
)
limiter = AdaptiveRateLimiter(config)

# æ£€æŸ¥è¯·æ±‚
decision = limiter.should_allow_request(request, system_metrics)
```

### 2. æµé‡åˆ†æå™¨ (rate_limit_analyzer.py)

åˆ†ææµé‡æ¨¡å¼ï¼Œæ£€æµ‹å¼‚å¸¸ï¼š

```python
from scripts.rate_limit_analyzer import RateLimitAnalyzer

analyzer = RateLimitAnalyzer()

# åˆ†ææµé‡
analysis = analyzer.analyze_traffic(time_window)
print(f"æµé‡æ¨¡å¼: {analysis.pattern}")
print(f"å¼‚å¸¸è¯„åˆ†: {analysis.anomaly_score}")
```

### 3. å‚æ•°æ ¡å‡†å™¨ (auto_calibrator.py)

è‡ªåŠ¨ä¼˜åŒ–é™æµå‚æ•°ï¼š

```python
from scripts.auto_calibrator import AutoCalibrator, OptimizationGoal

calibrator = AutoCalibrator(
    optimization_goal=OptimizationGoal.BALANCE_PERFORMANCE
)

# æ ¡å‡†å‚æ•°
optimized = calibrator.calibrate_parameters(
    current_params,
    system_metrics,
    traffic_analysis
)
```

### 4. æ€§èƒ½ç›‘æ§å™¨ (performance_monitor.py)

ç›‘æ§é™æµå½±å“ï¼Œæ£€æŸ¥SLAï¼š

```python
from scripts.performance_monitor import PerformanceMonitor, SLAConfig

sla_config = SLAConfig(
    availability_target=0.999,
    latency_p95_target=100,
    error_rate_target=0.001
)
monitor = PerformanceMonitor(sla_config)

# æ£€æŸ¥SLAåˆè§„æ€§
compliance = monitor.check_sla_compliance()
```

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install numpy scipy
```

### åŸºæœ¬ä½¿ç”¨

1. **å¯åŠ¨ç›‘æ§**:

```bash
python3 scripts/performance_monitor.py --monitor
```

2. **åˆ†ææµé‡**:

```bash
python3 scripts/rate_limit_analyzer.py --time-window 300
```

3. **æ ¡å‡†å‚æ•°**:

```bash
python3 scripts/auto_calibrator.py --goal balance
```

4. **è¿è¡ŒA/Bæµ‹è¯•**:

```bash
python3 scripts/auto_calibrator.py --test
```

---

## é…ç½®æŒ‡å—

### é™æµé…ç½® (rate_limit_config.json)

```json
{
  "algorithms": {
    "token_bucket": {
      "rate": 1000,
      "burst_size": 100,
      "refill_interval": 1.0
    },
    "sliding_window": {
      "window_size": 60,
      "max_requests": 60000
    }
  },
  "adaptation": {
    "enabled": true,
    "adjustment_interval": 30,
    "max_adjustment_ratio": 0.2,
    "min_samples": 100
  },
  "thresholds": {
    "cpu_high": 0.8,
    "memory_high": 0.85,
    "latency_p95_high": 100,
    "error_rate_high": 0.01
  }
}
```

### SLAé…ç½® (sla_config.json)

```json
{
  "availability_target": 0.999,
  "latency_targets": {
    "p50": 50,
    "p95": 100,
    "p99": 200
  },
  "error_rate_target": 0.001,
  "min_throughput": 1000,
  "evaluation_window": 300
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å¤„ç†æµé‡çªå‘

```python
import asyncio
from scripts.adaptive_rate_limiter import AdaptiveRateLimiter
from scripts.rate_limit_analyzer import RateLimitAnalyzer

async def handle_traffic_spike():
    limiter = AdaptiveRateLimiter()
    analyzer = RateLimitAnalyzer()

    # æ£€æµ‹æµé‡æ¨¡å¼
    analysis = await analyzer.analyze_traffic_async()

    if analysis.pattern == "spike":
        # è‡ªåŠ¨è°ƒæ•´å‚æ•°å¤„ç†çªå‘
        limiter.adapt_for_spike()
        print("å·²è°ƒæ•´å‚æ•°ä»¥å¤„ç†æµé‡çªå‘")

    # å¤„ç†è¯·æ±‚
    for request in incoming_requests:
        decision = limiter.should_allow_request(request)
        if decision.allowed:
            await process_request(request)
        else:
            await reject_request(request, decision.reason)
```

### ç¤ºä¾‹2: A/Bæµ‹è¯•æ–°é…ç½®

```python
from scripts.auto_calibrator import AutoCalibrator, Parameters

def test_new_configuration():
    calibrator = AutoCalibrator()

    # å½“å‰é…ç½®
    current_params = Parameters(
        rate_limit=1000,
        burst_size=100,
        window_size=60
    )

    # æµ‹è¯•é…ç½®ï¼ˆ20%å˜å¼‚ï¼‰
    test_params = current_params.mutate(0.2)

    # è¿è¡ŒA/Bæµ‹è¯•
    result = calibrator.run_ab_test(
        variant_a=current_params,
        variant_b=test_params,
        duration=3600,  # 1å°æ—¶
        traffic_split=0.5
    )

    print(f"è·èƒœè€…: {result.winner}")
    print(f"æ”¹è¿›: {result.improvement:.2f}%")
    print(f"ç½®ä¿¡åº¦: {result.confidence_level:.2%}")
```

### ç¤ºä¾‹3: ç›‘æ§SLAåˆè§„æ€§

```python
from scripts.performance_monitor import PerformanceMonitor, AlertSeverity

def monitor_sla_compliance():
    monitor = PerformanceMonitor()

    # å¯åŠ¨å®æ—¶ç›‘æ§
    monitor.start_monitoring(interval=10)

    # å®šæœŸæ£€æŸ¥SLA
    while True:
        compliance = monitor.check_sla_compliance()

        if compliance == "violation":
            # ç”Ÿæˆå‘Šè­¦
            alerts = monitor.generate_alerts(AlertSeverity.ERROR)
            for alert in alerts:
                send_alert(alert)

            # è§¦å‘è‡ªåŠ¨å›æ»š
            rollback_configuration()

        time.sleep(60)
```

---

## ç›‘æ§ä¸å‘Šè­¦

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | å‘Šè­¦é˜ˆå€¼ |
|------|------|----------|
| é™æµç‡ | è¢«é™æµè¯·æ±‚æ¯”ä¾‹ | > 10% |
| P95å»¶è¿Ÿ | 95%è¯·æ±‚çš„å»¶è¿Ÿ | > 100ms |
| é”™è¯¯ç‡ | è¯·æ±‚é”™è¯¯æ¯”ä¾‹ | > 0.1% |
| CPUä½¿ç”¨ç‡ | ç³»ç»ŸCPUå ç”¨ | > 80% |
| å†…å­˜ä½¿ç”¨ç‡ | ç³»ç»Ÿå†…å­˜å ç”¨ | > 85% |

### å‘Šè­¦çº§åˆ«

1. **INFO**: ä¿¡æ¯æ€§é€šçŸ¥
2. **WARNING**: æ¥è¿‘é˜ˆå€¼ï¼Œéœ€è¦å…³æ³¨
3. **ERROR**: è¶…è¿‡é˜ˆå€¼ï¼Œéœ€è¦å¤„ç†
4. **CRITICAL**: ä¸¥é‡é—®é¢˜ï¼Œéœ€è¦ç«‹å³å¤„ç†

### è‡ªåŠ¨å“åº”

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹è‡ªåŠ¨å“åº”ï¼š

- **å‚æ•°å›æ»š**: SLAè¿è§„æ—¶è‡ªåŠ¨å›æ»šåˆ°ä¸Šä¸€ä¸ªç¨³å®šé…ç½®
- **æµé‡é™çº§**: æ£€æµ‹åˆ°æ”»å‡»æ—¶è‡ªåŠ¨å¯ç”¨ä¸¥æ ¼é™æµ
- **æ‰©å®¹è§¦å‘**: èµ„æºä¸è¶³æ—¶è§¦å‘è‡ªåŠ¨æ‰©å®¹

---

## æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼è°ƒæ•´

```python
# æ¨èï¼šå°æ­¥è°ƒæ•´
config.max_adjustment_ratio = 0.2  # æ¯æ¬¡æœ€å¤šè°ƒæ•´20%

# é¿å…ï¼šæ¿€è¿›è°ƒæ•´
config.max_adjustment_ratio = 0.8  # å¯èƒ½å¯¼è‡´ç³»ç»Ÿéœ‡è¡
```

### 2. åˆç†çš„è¯„ä¼°çª—å£

```python
# çŸ­çª—å£ç”¨äºå¿«é€Ÿå“åº”
spike_window = 60  # 1åˆ†é’Ÿï¼Œç”¨äºæ£€æµ‹çªå‘

# é•¿çª—å£ç”¨äºç¨³å®šè¯„ä¼°
baseline_window = 3600  # 1å°æ—¶ï¼Œç”¨äºå»ºç«‹åŸºçº¿
```

### 3. å¤šç»´åº¦é™æµ

```python
# ç»„åˆå¤šä¸ªç»´åº¦
limits = {
    "user": 100,      # æ¯ç”¨æˆ·é™åˆ¶
    "ip": 1000,       # æ¯IPé™åˆ¶
    "global": 10000   # å…¨å±€é™åˆ¶
}
```

### 4. ä¼˜é›…é™çº§

```python
# åˆ†çº§æœåŠ¡
priority_levels = {
    "critical": 1.0,   # å…³é”®æœåŠ¡ï¼Œä¸é™æµ
    "normal": 0.5,     # æ™®é€šæœåŠ¡ï¼Œé€‚åº¦é™æµ
    "batch": 0.1       # æ‰¹å¤„ç†ï¼Œä¸¥æ ¼é™æµ
}
```

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. é™æµè¿‡åº¦

**ç—‡çŠ¶**: å¤§é‡åˆæ³•è¯·æ±‚è¢«æ‹’ç»

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥é™æµæ¯”ä¾‹
python3 scripts/rate_limit_analyzer.py --check-rejection-rate

# å¢åŠ é˜ˆå€¼
python3 scripts/auto_calibrator.py --adjust-threshold 1.5
```

#### 2. å‚æ•°éœ‡è¡

**ç—‡çŠ¶**: å‚æ•°é¢‘ç¹è°ƒæ•´å¯¼è‡´æ€§èƒ½ä¸ç¨³å®š

**è§£å†³æ–¹æ¡ˆ**:
```python
# å¢åŠ è°ƒæ•´é—´éš”
config.adjustment_interval = 60  # 60ç§’

# å‡å°è°ƒæ•´å¹…åº¦
config.max_adjustment_ratio = 0.1  # 10%
```

#### 3. SLAè¿è§„

**ç—‡çŠ¶**: å»¶è¿Ÿæˆ–é”™è¯¯ç‡è¶…æ ‡

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å›æ»šé…ç½®
python3 scripts/auto_calibrator.py --rollback

# é‡æ–°æ ¡å‡†
python3 scripts/auto_calibrator.py --goal latency
```

### è°ƒè¯•å‘½ä»¤

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
cat config/rate_limit_config.json | jq .

# å®æ—¶ç›‘æ§
tail -f logs/rate_limit.log

# æ€§èƒ½åˆ†æ
python3 scripts/performance_monitor.py --export json

# æµé‡åˆ†æ
python3 scripts/rate_limit_analyzer.py --verbose
```

---

## é›†æˆæŒ‡å—

### ä¸FastAPIé›†æˆ

```python
from fastapi import FastAPI, Request, HTTPException
from scripts.adaptive_rate_limiter import AdaptiveRateLimiter

app = FastAPI()
limiter = AdaptiveRateLimiter()

@app.middleware("http")
async def rate_limit_middleware(request: Request, call_next):
    # è·å–ç³»ç»ŸæŒ‡æ ‡
    metrics = get_system_metrics()

    # æ£€æŸ¥é™æµ
    decision = limiter.should_allow_request(request, metrics)

    if not decision.allowed:
        raise HTTPException(
            status_code=429,
            detail=f"Rate limit exceeded: {decision.reason}"
        )

    response = await call_next(request)
    return response
```

### ä¸Prometheusé›†æˆ

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'rate_limiter'
    static_configs:
      - targets: ['localhost:9091']
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'rate_limit_.*'
        action: keep
```

### ä¸GitHub Actionsé›†æˆ

å·²æä¾›å®Œæ•´çš„GitHub Actionså·¥ä½œæµï¼š`.github/workflows/adaptive-rate-limit-monitor.yml`

ä¸»è¦åŠŸèƒ½ï¼š
- è‡ªåŠ¨åˆ†ææµé‡æ¨¡å¼
- æ£€æŸ¥SLAåˆè§„æ€§
- è‡ªåŠ¨æ ¡å‡†å‚æ•°
- æ€§èƒ½é€€åŒ–æ—¶è‡ªåŠ¨å›æ»š

---

## æ€§èƒ½åŸºå‡†

### æµ‹è¯•ç¯å¢ƒ

- CPU: 4æ ¸
- å†…å­˜: 8GB
- å¹¶å‘è¿æ¥: 10,000

### æ€§èƒ½æ•°æ®

| ç®—æ³• | QPS | P95å»¶è¿Ÿ | CPUä½¿ç”¨ç‡ | å†…å­˜ä½¿ç”¨ |
|------|-----|---------|-----------|----------|
| ä»¤ç‰Œæ¡¶ | 50,000 | 2ms | 40% | 200MB |
| æ¼æ¡¶ | 45,000 | 3ms | 35% | 180MB |
| æ»‘åŠ¨çª—å£ | 40,000 | 5ms | 45% | 300MB |
| è‡ªé€‚åº”çª—å£ | 48,000 | 3ms | 42% | 250MB |

---

## ç‰ˆæœ¬å†å²

### v1.0.0 (2025-11-24)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒ4ç§é™æµç®—æ³•
- åŸºæœ¬çš„è‡ªé€‚åº”è°ƒæ•´
- SLAç›‘æ§åŠŸèƒ½

### è®¡åˆ’åŠŸèƒ½

- æ”¯æŒåˆ†å¸ƒå¼é™æµ
- æœºå™¨å­¦ä¹ æ¨¡å‹ä¼˜åŒ–
- æ›´å¤šçš„æµé‡æ¨¡å¼è¯†åˆ«
- WebUIç›‘æ§ç•Œé¢

---

## ç›¸å…³èµ„æº

- [APIå‚è€ƒæ–‡æ¡£](./API_REFERENCE.md)
- [å‚æ•°è°ƒä¼˜æŒ‡å—](./TUNING_GUIDE.md)
- [GitHubä»“åº“](https://github.com/your-repo/cad-ml-platform)
- [é—®é¢˜åé¦ˆ](https://github.com/your-repo/cad-ml-platform/issues)

---

**æœ€åæ›´æ–°**: 2025-11-24