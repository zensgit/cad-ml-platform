# CAD分类器边界案例文档

## 概述

V16超级集成分类器达到99.88%准确率（856样本中仅1个错误）。本文档记录已知的分类边界案例，供用户在实际应用中参考。

## 分类类别

| 类别 | 描述 | 典型零件 |
|------|------|----------|
| 轴类 | 旋转类零件，通常有轴向对称性 | 传动轴、主轴、芯轴 |
| 传动件 | 传递动力的零件 | 齿轮、皮带轮、链轮、飞轮 |
| 壳体类 | 包覆/容纳其他零件的结构件 | 箱体、端盖、壳体 |
| 连接件 | 用于连接/固定的零件 | 法兰、螺栓、卡簧 |
| 其他 | 不属于以上类别的零件 | 垫片、支架、杂项 |

## 已知边界案例

### 1. 连接件 vs 传动件

**典型零件**: 卡簧、挡圈、弹性挡圈

**分类歧义原因**:
- **按功能分类**: 卡簧用于轴向固定（连接功能），应归入"连接件"
- **按应用场景分类**: 卡簧常用于传动轴系统，可归入"传动件"

**建议处理方式**:
- 当模型预测为"连接件"或"传动件"且置信度差距<15%时，建议人工复核
- 可根据具体应用场景选择更合适的分类

**实际案例**:
- `连接件/old_0008.dxf`: 卡簧/挡圈，标注为连接件，模型预测为传动件

### 2. 壳体类 vs 其他

**典型零件**: 端盖、法兰盘、盖板

**分类歧义原因**:
- **按结构分类**: 端盖有壳体特征（包覆功能），应归入"壳体类"
- **按功能分类**: 某些端盖主要用于密封/连接，可归入"其他"或"连接件"

**建议处理方式**:
- 关注零件的主要功能
- 若是箱体/机壳的组成部分，倾向"壳体类"
- 若仅用于密封/遮挡，可归入"其他"

## 置信度阈值说明

V16分类器内置了自动审核机制：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `CONFIDENCE_THRESHOLD` | 0.85 | 置信度低于此值时标记需审核 |
| `MARGIN_THRESHOLD` | 0.15 | top1与top2差距小于此值时标记需审核 |

### 返回结果字段

```python
ClassificationResult:
    category: str           # 预测类别
    confidence: float       # 置信度
    needs_review: bool      # 是否需要人工审核
    review_reason: str      # 审核原因（如有）
    top2_category: str      # 第二可能类别
    top2_confidence: float  # 第二类别置信度
    probabilities: dict     # 各类别概率分布
```

### 触发审核的条件

1. **置信度不足**: `confidence < 0.85`
2. **预测不确定**: `confidence - top2_confidence < 0.15`
3. **已知边界案例**: top1和top2属于已知易混淆类别对

## 使用建议

### 1. 自动化流程
```python
result = classify_part_v16("part.dxf")

if result.needs_review:
    # 发送到人工审核队列
    send_to_review_queue(result)
else:
    # 自动处理
    process_classification(result)
```

### 2. 批量处理策略
```python
results = classifier.predict_batch(dxf_files)

# 统计需要审核的比例
review_count = sum(1 for r in results if r and r.needs_review)
auto_count = len(results) - review_count

print(f"自动处理: {auto_count}, 需审核: {review_count}")
```

**批量接口注意事项**:
- 结果顺序与上传文件顺序一致，即使存在同名文件也不会合并。

### 3. 自定义阈值
```python
# 更严格的审核（更多样本需要人工确认）
classifier = PartClassifierV16(confidence_threshold=0.90)

# 更宽松的审核（减少人工干预）
classifier = PartClassifierV16(confidence_threshold=0.75)
```

## 改进建议

如需进一步提升分类准确率或减少边界案例：

1. **扩充训练数据**: 收集更多边界案例样本
2. **细化分类体系**: 考虑添加子类别（如"轴用连接件"）
3. **多模型投票**: 在V16基础上引入其他特征提取方法
4. **业务规则后处理**: 根据具体业务场景添加规则修正

## 版本历史

| 版本 | 准确率 | 主要变更 |
|------|--------|----------|
| V16 | 99.88% | V6+V14超级集成，添加置信度审核机制 |
| V14 | 99.65% | 视觉+几何融合，5折交叉验证集成 |
| V6 | 99.30% | 48维增强几何特征 |
