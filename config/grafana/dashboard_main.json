{
  "title": "CAD ML Platform - Main Dashboard",
  "uid": "cad-ml-platform-main",
  "timezone": "browser",
  "schemaVersion": 36,
  "version": 1,
  "refresh": "30s",
  "tags": ["cad", "ml", "platform", "v1.0"],
  "annotations": {
    "list": [
      {
        "datasource": "Prometheus",
        "enable": true,
        "expr": "changes(process_start_time_seconds[5m]) > 0",
        "iconColor": "orange",
        "name": "Restarts",
        "titleFormat": "Service Restart"
      }
    ]
  },
  "templating": {
    "list": [
      {
        "name": "interval",
        "type": "interval",
        "options": [
          {"text": "1m", "value": "1m"},
          {"text": "5m", "value": "5m"},
          {"text": "15m", "value": "15m"},
          {"text": "30m", "value": "30m"},
          {"text": "1h", "value": "1h"}
        ],
        "current": {"text": "5m", "value": "5m"}
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "type": "row",
      "title": "Analysis Overview",
      "gridPos": {"x": 0, "y": 0, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Success Rate",
      "description": "Analysis request success rate over selected interval",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "(sum(rate(analysis_requests_total{status=\"success\"}[$interval])) / sum(rate(analysis_requests_total[$interval]))) * 100",
          "refId": "A"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 90},
              {"color": "green", "value": 95}
            ]
          }
        }
      },
      "gridPos": {"x": 0, "y": 1, "w": 4, "h": 4}
    },
    {
      "id": 3,
      "type": "stat",
      "title": "QPS",
      "description": "Queries per second",
      "datasource": "Prometheus",
      "targets": [
        {"expr": "sum(rate(analysis_requests_total[$interval]))", "refId": "A"}
      ],
      "options": {"colorMode": "value", "graphMode": "area"},
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null}
            ]
          }
        }
      },
      "gridPos": {"x": 4, "y": 1, "w": 4, "h": 4}
    },
    {
      "id": 4,
      "type": "stat",
      "title": "Feature Cache Hit Rate",
      "description": "Feature cache effectiveness",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "(sum(rate(feature_cache_hits_total[$interval])) / (sum(rate(feature_cache_hits_total[$interval])) + sum(rate(feature_cache_miss_total[$interval])))) * 100",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 35},
              {"color": "green", "value": 60}
            ]
          }
        }
      },
      "gridPos": {"x": 8, "y": 1, "w": 4, "h": 4}
    },
    {
      "id": 5,
      "type": "stat",
      "title": "Model Health",
      "description": "Model health check status",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(model_health_checks_total{status=\"ok\"}[$interval])) / sum(rate(model_health_checks_total[$interval])) * 100",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 80},
              {"color": "green", "value": 95}
            ]
          }
        }
      },
      "gridPos": {"x": 12, "y": 1, "w": 4, "h": 4}
    },
    {
      "id": 6,
      "type": "stat",
      "title": "Vector Store Size",
      "description": "Current Faiss index size",
      "datasource": "Prometheus",
      "targets": [
        {"expr": "faiss_index_size", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "short", "decimals": 0}},
      "gridPos": {"x": 16, "y": 1, "w": 4, "h": 4}
    },
    {
      "id": 7,
      "type": "stat",
      "title": "Active Errors",
      "description": "Error rate in last interval",
      "datasource": "Prometheus",
      "targets": [
        {"expr": "sum(rate(analysis_errors_total[$interval]))", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 0.1},
              {"color": "red", "value": 1}
            ]
          }
        }
      },
      "gridPos": {"x": 20, "y": 1, "w": 4, "h": 4}
    },
    {
      "id": 8,
      "type": "row",
      "title": "Batch Similarity Latency",
      "gridPos": {"x": 0, "y": 5, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 9,
      "type": "timeseries",
      "title": "Batch Similarity Latency (p50/p95/p99)",
      "description": "Latency percentiles for batch similarity queries by size range",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum by (le, batch_size_range) (rate(vector_query_batch_latency_seconds_bucket[$interval])))",
          "legendFormat": "p50 - {{batch_size_range}}",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le, batch_size_range) (rate(vector_query_batch_latency_seconds_bucket[$interval])))",
          "legendFormat": "p95 - {{batch_size_range}}",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum by (le, batch_size_range) (rate(vector_query_batch_latency_seconds_bucket[$interval])))",
          "legendFormat": "p99 - {{batch_size_range}}",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {"lineWidth": 1, "fillOpacity": 10, "spanNulls": true}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "gridPos": {"x": 0, "y": 6, "w": 12, "h": 8}
    },
    {
      "id": 10,
      "type": "timeseries",
      "title": "Query Backend Distribution",
      "description": "Distribution of queries across backends (faiss vs memory_fallback)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (backend) (rate(vector_query_backend_total[$interval]))",
          "legendFormat": "{{backend}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {"lineWidth": 2, "fillOpacity": 30}
        }
      },
      "gridPos": {"x": 12, "y": 6, "w": 12, "h": 8}
    },
    {
      "id": 11,
      "type": "row",
      "title": "Feature Cache Performance",
      "gridPos": {"x": 0, "y": 14, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 12,
      "type": "timeseries",
      "title": "Feature Cache Hit/Miss Rate",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(feature_cache_hits_total[$interval]))",
          "legendFormat": "Hits",
          "refId": "A"
        },
        {
          "expr": "sum(rate(feature_cache_miss_total[$interval]))",
          "legendFormat": "Misses",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {"lineWidth": 2, "fillOpacity": 20}
        },
        "overrides": [
          {"matcher": {"id": "byName", "options": "Hits"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "Misses"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]}
        ]
      },
      "gridPos": {"x": 0, "y": 15, "w": 8, "h": 6}
    },
    {
      "id": 13,
      "type": "gauge",
      "title": "Cache Size",
      "datasource": "Prometheus",
      "targets": [
        {"expr": "feature_cache_size", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "min": 0,
          "max": 10000,
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      },
      "gridPos": {"x": 8, "y": 15, "w": 4, "h": 6}
    },
    {
      "id": 14,
      "type": "stat",
      "title": "Cache Evictions",
      "datasource": "Prometheus",
      "targets": [
        {"expr": "sum(rate(feature_cache_evictions_total[$interval]))", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 1},
              {"color": "red", "value": 10}
            ]
          }
        }
      },
      "gridPos": {"x": 12, "y": 15, "w": 4, "h": 6}
    },
    {
      "id": 15,
      "type": "timeseries",
      "title": "Cache Lookup Latency (p95)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(feature_cache_lookup_seconds_bucket[$interval])) by (le))",
          "legendFormat": "p95 lookup",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "s"}},
      "gridPos": {"x": 16, "y": 15, "w": 8, "h": 6}
    },
    {
      "id": 16,
      "type": "row",
      "title": "Model Health Status",
      "gridPos": {"x": 0, "y": 21, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 17,
      "type": "piechart",
      "title": "Model Health Check Distribution",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (status) (rate(model_health_checks_total[$interval]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "fieldConfig": {
        "overrides": [
          {"matcher": {"id": "byName", "options": "ok"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "rollback"}, "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "error"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "absent"}, "properties": [{"id": "color", "value": {"fixedColor": "gray", "mode": "fixed"}}]}
        ]
      },
      "gridPos": {"x": 0, "y": 22, "w": 6, "h": 6}
    },
    {
      "id": 18,
      "type": "timeseries",
      "title": "Model Reload Events",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (status) (rate(model_reload_total[$interval]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "gridPos": {"x": 6, "y": 22, "w": 6, "h": 6}
    },
    {
      "id": 19,
      "type": "timeseries",
      "title": "Model Security Failures",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (reason) (rate(model_security_fail_total[$interval]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {"lineWidth": 2}
        }
      },
      "gridPos": {"x": 12, "y": 22, "w": 6, "h": 6}
    },
    {
      "id": 20,
      "type": "stat",
      "title": "Classification Model Version",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "topk(1, sum by (version) (rate(classification_model_version_total[$interval])))",
          "legendFormat": "{{version}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "string"}},
      "gridPos": {"x": 18, "y": 22, "w": 6, "h": 6}
    },
    {
      "id": 21,
      "type": "row",
      "title": "Vector Store Statistics",
      "gridPos": {"x": 0, "y": 28, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 22,
      "type": "timeseries",
      "title": "Vector Migration Outcomes",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (status) (rate(vector_migrate_total[$interval]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {"unit": "short"},
        "overrides": [
          {"matcher": {"id": "byName", "options": "migrated"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "downgraded"}, "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "skipped"}, "properties": [{"id": "color", "value": {"fixedColor": "yellow", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "error"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]}
        ]
      },
      "gridPos": {"x": 0, "y": 29, "w": 8, "h": 6}
    },
    {
      "id": 23,
      "type": "heatmap",
      "title": "Migration Dimension Delta Distribution",
      "description": "Distribution of dimension changes during migration (new_dim - old_dim)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(increase(vector_migrate_dimension_delta_bucket[$interval])) by (le)",
          "format": "heatmap",
          "legendFormat": "{{le}}",
          "refId": "A"
        }
      ],
      "options": {"calculate": false, "cellGap": 1, "color": {"mode": "scheme", "scheme": "Spectral"}},
      "gridPos": {"x": 8, "y": 29, "w": 8, "h": 6}
    },
    {
      "id": 24,
      "type": "timeseries",
      "title": "Faiss Index Operations",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (status) (rate(faiss_rebuild_total[$interval]))",
          "legendFormat": "rebuild-{{status}}",
          "refId": "A"
        },
        {
          "expr": "sum by (status) (rate(faiss_export_total[$interval]))",
          "legendFormat": "export-{{status}}",
          "refId": "B"
        },
        {
          "expr": "sum by (status) (rate(faiss_import_total[$interval]))",
          "legendFormat": "import-{{status}}",
          "refId": "C"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "gridPos": {"x": 16, "y": 29, "w": 8, "h": 6}
    },
    {
      "id": 25,
      "type": "row",
      "title": "Error Distribution",
      "gridPos": {"x": 0, "y": 35, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 26,
      "type": "piechart",
      "title": "Errors by Stage",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (stage) (rate(analysis_errors_total[$interval]))",
          "legendFormat": "{{stage}}",
          "refId": "A"
        }
      ],
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "gridPos": {"x": 0, "y": 36, "w": 8, "h": 6}
    },
    {
      "id": 27,
      "type": "table",
      "title": "Top Error Codes",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "topk(10, sum by (code) (rate(analysis_error_code_total[$interval])))",
          "format": "table",
          "instant": true,
          "refId": "A"
        }
      ],
      "transformations": [
        {"id": "organize", "options": {"excludeByName": {"Time": true}}}
      ],
      "gridPos": {"x": 8, "y": 36, "w": 8, "h": 6}
    },
    {
      "id": 28,
      "type": "timeseries",
      "title": "Rejection Reasons",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (reason) (rate(analysis_rejections_total[$interval]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "gridPos": {"x": 16, "y": 36, "w": 8, "h": 6}
    },
    {
      "id": 29,
      "type": "row",
      "title": "v4 Feature Extraction & Security",
      "gridPos": {"x": 0, "y": 42, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 30,
      "type": "timeseries",
      "title": "Feature Extraction Latency by Version",
      "description": "Comparison of v3 vs v4 feature extraction latency",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, version) (rate(feature_extraction_latency_seconds_bucket[$interval])))",
          "legendFormat": "p95 - {{version}}",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.50, sum by (le, version) (rate(feature_extraction_latency_seconds_bucket[$interval])))",
          "legendFormat": "p50 - {{version}}",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {"lineWidth": 2, "fillOpacity": 10}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "gridPos": {"x": 0, "y": 43, "w": 8, "h": 6}
    },
    {
      "id": 31,
      "type": "stat",
      "title": "Pickle Opcode Mode",
      "description": "Current pickle security opcode scanning mode",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "model_opcode_mode",
          "legendFormat": "mode",
          "refId": "A"
        }
      ],
      "options": {
        "colorMode": "background",
        "textMode": "name"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {"options": {"0": {"text": "AUDIT", "color": "blue"}}, "type": "value"},
            {"options": {"1": {"text": "BLOCKLIST", "color": "orange"}}, "type": "value"},
            {"options": {"2": {"text": "WHITELIST", "color": "green"}}, "type": "value"}
          ]
        }
      },
      "gridPos": {"x": 8, "y": 43, "w": 4, "h": 3}
    },
    {
      "id": 32,
      "type": "stat",
      "title": "Opcode Scans Total",
      "description": "Total pickle opcode scans performed",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(increase(model_opcode_scans_total[$interval]))",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short", "decimals": 0}},
      "gridPos": {"x": 8, "y": 46, "w": 4, "h": 3}
    },
    {
      "id": 33,
      "type": "piechart",
      "title": "Model Security Failures",
      "description": "Distribution of model security failure reasons",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (reason) (rate(model_security_fail_total[$interval]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "fieldConfig": {
        "overrides": [
          {"matcher": {"id": "byName", "options": "hash_mismatch"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "magic_number_invalid"}, "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "opcode_blocked"}, "properties": [{"id": "color", "value": {"fixedColor": "purple", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "opcode_scan_error"}, "properties": [{"id": "color", "value": {"fixedColor": "yellow", "mode": "fixed"}}]}
        ]
      },
      "gridPos": {"x": 12, "y": 43, "w": 6, "h": 6}
    },
    {
      "id": 34,
      "type": "timeseries",
      "title": "Dangerous Opcode Detections",
      "description": "Dangerous opcodes detected by type",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (opcode) (rate(model_opcode_blocked_total[$interval]))",
          "legendFormat": "{{opcode}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {"lineWidth": 2}
        }
      },
      "gridPos": {"x": 18, "y": 43, "w": 6, "h": 6}
    },
    {
      "id": 35,
      "type": "row",
      "title": "Drift Detection & Cache Tuning",
      "gridPos": {"x": 0, "y": 49, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 36,
      "type": "piechart",
      "title": "Drift Refresh Triggers",
      "description": "Distribution of drift baseline refresh trigger types",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (trigger) (rate(drift_baseline_refresh_total[$interval]))",
          "legendFormat": "{{trigger}}",
          "refId": "A"
        }
      ],
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "fieldConfig": {
        "overrides": [
          {"matcher": {"id": "byName", "options": "auto"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "manual"}, "properties": [{"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "scheduled"}, "properties": [{"id": "color", "value": {"fixedColor": "yellow", "mode": "fixed"}}]}
        ]
      },
      "gridPos": {"x": 0, "y": 50, "w": 6, "h": 6}
    },
    {
      "id": 37,
      "type": "timeseries",
      "title": "Drift Score Trend",
      "description": "Drift score over time",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(material_distribution_drift_score_bucket[$interval])))",
          "legendFormat": "Material Drift p95",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(classification_prediction_drift_score_bucket[$interval])))",
          "legendFormat": "Prediction Drift p95",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {"lineWidth": 2}
        },
        "overrides": []
      },
      "gridPos": {"x": 6, "y": 50, "w": 6, "h": 6}
    },
    {
      "id": 38,
      "type": "table",
      "title": "Cache Tuning Recommendations",
      "description": "Latest cache tuning recommendations",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "feature_cache_tuning_recommended_capacity",
          "format": "table",
          "instant": true,
          "legendFormat": "Capacity",
          "refId": "A"
        },
        {
          "expr": "feature_cache_tuning_recommended_ttl_seconds",
          "format": "table",
          "instant": true,
          "legendFormat": "TTL",
          "refId": "B"
        }
      ],
      "gridPos": {"x": 12, "y": 50, "w": 6, "h": 6}
    },
    {
      "id": 39,
      "type": "stat",
      "title": "Baseline Age (hours)",
      "description": "Age of current drift baseline",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "max(baseline_material_age_seconds, baseline_prediction_age_seconds) / 3600",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "h",
          "decimals": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 24},
              {"color": "red", "value": 72}
            ]
          }
        }
      },
      "gridPos": {"x": 18, "y": 50, "w": 6, "h": 6}
    },
    {
      "id": 40,
      "type": "row",
      "title": "Model Rollback Status",
      "gridPos": {"x": 0, "y": 56, "w": 24, "h": 1},
      "collapsed": false
    },
    {
      "id": 41,
      "type": "stat",
      "title": "Current Rollback Level",
      "description": "Current model rollback level (0=none, 1-3=rollback depth)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "model_rollback_level",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "mappings": [
            {"options": {"0": {"text": "Normal", "color": "green"}}, "type": "value"},
            {"options": {"1": {"text": "Level 1", "color": "yellow"}}, "type": "value"},
            {"options": {"2": {"text": "Level 2", "color": "orange"}}, "type": "value"},
            {"options": {"3": {"text": "Level 3", "color": "red"}}, "type": "value"}
          ]
        }
      },
      "options": {"colorMode": "background"},
      "gridPos": {"x": 0, "y": 57, "w": 4, "h": 4}
    },
    {
      "id": 42,
      "type": "timeseries",
      "title": "Rollback Events",
      "description": "Model rollback events by level",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum by (level) (rate(model_rollback_total[$interval]))",
          "legendFormat": "Level {{level}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "gridPos": {"x": 4, "y": 57, "w": 8, "h": 4}
    },
    {
      "id": 43,
      "type": "stat",
      "title": "Available Snapshots",
      "description": "Number of model snapshots available for rollback",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "model_snapshots_available",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red", "value": null},
              {"color": "yellow", "value": 1},
              {"color": "green", "value": 3}
            ]
          }
        }
      },
      "gridPos": {"x": 12, "y": 57, "w": 4, "h": 4}
    },
    {
      "id": 44,
      "type": "timeseries",
      "title": "v4 Feature Distribution",
      "description": "Distribution of surface_count and shape_entropy values",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(v4_surface_count_bucket[$interval])) by (le))",
          "legendFormat": "surface_count p50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(v4_surface_count_bucket[$interval])) by (le))",
          "legendFormat": "surface_count p95",
          "refId": "B"
        },
        {
          "expr": "avg(rate(v4_shape_entropy_sum[$interval]) / rate(v4_shape_entropy_count[$interval]))",
          "legendFormat": "shape_entropy avg",
          "refId": "C"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "gridPos": {"x": 16, "y": 57, "w": 8, "h": 4}
    }
  ],
  "time": {"from": "now-6h", "to": "now"},
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h"],
    "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d"]
  }
}
