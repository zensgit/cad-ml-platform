# 工艺特征集成评估报告

**日期**: 2026-01-27
**版本**: v1.0

## 概述

本报告评估将工艺特征（热处理、表面处理、焊接）集成到 HybridClassifier 后的分类效果。

## 实现摘要

### 新增组件

1. **ProcessClassifier** (`src/ml/process_classifier.py`)
   - 基于工艺特征推断图纸类型
   - 热处理/表面处理 → 零件图/机械制图
   - 焊接信息 → 装配图/结构件/焊接件

2. **HybridClassifier 集成**
   - 新增 PROCESS_FEATURES_ENABLED 标志 (default: true)
   - 新增 PROCESS_FUSION_WEIGHT 权重 (default: 0.15)
   - 4源融合逻辑：filename + graph2d + titleblock + process

### 工艺提取增强

- 新增 HeatTreatmentType: quench_temper, solution_treatment, general_heat_treatment
- 支持"热处理后硬度HRC35-45"等通用格式

## 评估结果

### 数据集

- 159 个 DXF 文件
- 来源：real_dxf + synthetic_dxf

### 工艺特征覆盖率

| 特征类型 | 文件数 | 覆盖率 |
|----------|--------|--------|
| 表面处理 | 48 | 30.2% |
| 焊接 | 32 | 20.1% |
| 通用技术要求 | 25 | 15.7% |
| 热处理 | 3 | 1.9% |
| **总计** | **68** | **42.8%** |

### 分类效果对比

| 指标 | 启用工艺特征 | 禁用工艺特征 | 差异 |
|------|-------------|-------------|------|
| 平均置信度 | 0.6557 | 0.6557 | 0.0000 |
| 融合决策数 | 2 | 2 | 0 |
| 标签变化数 | 0 | - | - |

### 决策来源分布

| 来源 | 文件数 | 占比 |
|------|--------|------|
| filename | 109 | 68.6% |
| fallback | 48 | 30.2% |
| fusion | 2 | 1.3% |

## 分析

### 为什么工艺特征暂无显著提升？

1. **Filename 分类器主导**：109/159 文件由 filename 高置信度 (0.95) 直接决定，不进入融合阶段
2. **不同分类层级**：工艺建议是图纸类型（零件图/装配图），而 filename 返回具体名称（如"短轴承座"）
3. **融合触发条件未满足**：只有 filename 置信度 < 0.8 时才考虑其他信号

### 工艺特征的实际价值

1. **元数据输出**：API 已暴露 `process_requirements` 字段，包含：
   - 热处理信息（类型、硬度、深度）
   - 表面处理信息（类型、厚度）
   - 焊接信息（类型、焊脚、焊材）
   - 通用技术要求

2. **融合辅助**：在 2 个"拖车"文件中参与融合决策

3. **业务扩展**：可用于：
   - 工艺路线自动推荐
   - 制造成本估算
   - 质量检验项生成

## 测试覆盖

- ProcessClassifier 单元测试：16 个测试全部通过
- process_parser 单元测试：29 个测试全部通过

## 结论

工艺特征集成已完成并正确工作。当前数据集中 filename 分类准确度高，工艺特征作为辅助信号暂无显著提升。但工艺信息作为独立元数据输出，为后续业务功能提供了基础。

## 建议后续工作

1. 在 filename 模糊场景下评估工艺特征效果
2. 利用工艺信息开发工艺路线推荐功能
3. 考虑将图纸类型（零件图/装配图）与具体名称分层输出
