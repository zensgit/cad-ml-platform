# Example environment overrides for CAD ML Platform

# Server
DEBUG=true
HOST=0.0.0.0
PORT=8000
WORKERS=1
LOG_LEVEL=INFO

# CORS / Trusted hosts
CORS_ORIGINS=["*"]
ALLOWED_HOSTS=["*"]

# Redis
REDIS_ENABLED=false
REDIS_URL=redis://localhost:6379/0

# Vision Provider Configuration
# Provider selection: auto, stub, deepseek, openai, anthropic
VISION_PROVIDER=auto  # auto-detects based on available API keys

# DeepSeek Vision API (https://platform.deepseek.com)
# DEEPSEEK_API_KEY=sk-...

# OpenAI Vision API (GPT-4o) (https://platform.openai.com)
# OPENAI_API_KEY=sk-...
# OPENAI_VISION_MODEL=gpt-4o  # Options: gpt-4o, gpt-4-turbo
# OPENAI_VISION_DETAIL=high  # Options: low, high, auto

# Anthropic Vision API (Claude) (https://console.anthropic.com)
# ANTHROPIC_API_KEY=sk-ant-...
# ANTHROPIC_VISION_MODEL=claude-sonnet-4-20250514  # Or claude-3-5-sonnet-20241022

# Vision / OCR limits
# Max Base64 size for vision input (bytes). Default: 1048576 (1MB)
VISION_MAX_BASE64_BYTES=1048576
# Error rate EMA smoothing (0<alpha<=1). Higher reacts faster. Default: 0.2
ERROR_EMA_ALPHA=0.2
# OCR PDF page upper bound (override internal constant if added). Suggest <=20
OCR_MAX_PDF_PAGES=20
# OCR max file size in MB (override internal constant). Suggest <=50
OCR_MAX_FILE_MB=50

# Vector Store
VECTOR_STORE_BACKEND=memory  # Options: memory, faiss, redis

# Faiss Configuration
FAISS_INDEX_TYPE=flat  # Options: flat (brute-force), hnsw (approximate)
# HNSW parameters (only used when FAISS_INDEX_TYPE=hnsw)
FAISS_HNSW_M=32  # Graph connectivity: higher = better recall, more memory (16-64)
FAISS_HNSW_EF_CONSTRUCTION=40  # Build-time search depth: higher = better quality index (40-200)
FAISS_HNSW_EF_SEARCH=16  # Query-time search depth: higher = better recall, slower (16-256)

# 2D CAD 查重（DedupCAD-Vision + v2 JSON 精查）
# DedupCAD-Vision 服务地址（cad-ml-platform 会代理调用）
DEDUPCAD_VISION_URL=http://localhost:58001
DEDUPCAD_VISION_TIMEOUT_SECONDS=30

# 插件导出的 v2 JSON 存储位置（按 file_hash 落盘）
DEDUPCAD_GEOM_STORE_DIR=data/dedup_geom
DEDUPCAD_GEOM_STORE_SUFFIX=.v2.json

# 2D 查重：租户默认阈值/预设配置（按 X-API-Key）
# 用于让客户端不必每次请求都带一堆参数（需配合 /api/v1/dedup/2d/config 管理接口）
DEDUPCAD_TENANT_CONFIG_DIR=data/dedup_tenant_configs
DEDUPCAD_TENANT_CONFIG_CACHE_TTL_SECONDS=3600
# DEDUPCAD_TENANT_CONFIG_PREFIX=dedup2d

# L4 精查：是否启用 entities_geom_hash 回退（可能提升召回，但也可能增加误报）
# 默认：unset/0（关闭）
# CAD_ML_PLATFORM_L4_ENTITIES_GEOM_HASH=1

# DWG 批处理：ODA File Converter（Windows / macOS）
# Windows:
# ODA_FILE_CONVERTER_EXE=C:\\Path\\To\\ODAFileConverter.exe
# macOS:
# ODA_FILE_CONVERTER_EXE=/Applications/ODAFileConverter.app/Contents/MacOS/ODAFileConverter
# ODA_OUTPUT_VERSION=ACAD2018

# DWG 批处理：自定义 DWG->DXF 命令模板（使用 {input} / {output}）
# DWG_TO_DXF_CMD=dwg2dxf \"{input}\" \"{output}\"

# 精查权重调参（可选；默认值在 Settings 中）
# DEDUPCAD2_W_ENTITIES=1.0
# DEDUPCAD2_W_LAYERS=0.2
# DEDUPCAD2_W_DIMENSIONS=0.5
# DEDUPCAD2_W_TEXT=0.3
# DEDUPCAD2_W_DIM_EXTRA=0.0
# DEDUPCAD2_W_HATCH_EXTRA=0.0
